<script>
function searchForNearest() {
  document.getElementById('busy').style.visibility = 'visible';
  navigator.geolocation.getCurrentPosition(function(pos) {
    document.location.href = '/mirrors?q=loc:' + pos.coords.latitude + ',' + pos.coords.longitude;
  },
                                               function(){},
                                               {maximumAge:600000});
}

function disableTag(tag) {
    document.location.href = '/mirrors' + (document.location.search || '?q=') + ' ' + tag;
}
</script>

<%- query = req.parameters.q %>
<br>
<div class="search-bar">

  <strong>Tags</strong>
  <div class="search-tag">
    <ul>
    <li><a href="javascript:disableTag('http')" style="background-color: <% "stable".to_color %>">http</a></li>
    <li><a href="javascript:disableTag('ftp')" style="background-color: <% "moose".to_color %>">ftp</a></li>
    <li><a href="javascript:disableTag('rsync')" style="background-color: <% "deprecated".to_color %>">rsync</a></li>
  </ul>
  </div>
  <hr>
  <strong>Sorting</strong>
  <ul>
    <img src="/static/icons/busy.gif" style="float: right; visibility: hidden" id="busy">
    <a href="javascript:searchForNearest()"><li>Nearest</li></a>
  </ul>
</div>

<div class="search-results">


<% 
FOREACH mirror IN mirrors;
date = mirror.inceptdate.dt;
day = date.day _ '/' _ date.month _ '/' _ date.year %>

<div>
  <strong>
    <% mirror.name %> (<% mirror.org %>)</strong> 
    <% IF mirror.http %><a href="<% mirror.http %>">http</a><% END %>
    <% IF mirror.ftp %><a href="<% mirror.ftp %>">ftp</a><% END %>
    <% IF mirror.rsync %><a href="<% mirror.rsync %>">rsync</a><% END %>
    <% IF mirror.distance %>(<% mirror.distance | format_number %> km)<% END %>
</div>
<% END %>

</div>