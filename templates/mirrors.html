<script>
function searchForNearest() {
  document.getElementById('busy').style.visibility = 'visible';
  navigator.geolocation.getCurrentPosition(function(pos) {
    document.location.href = '/mirrors?q=loc:' + pos.coords.latitude + ',' + pos.coords.longitude;
  },
                                               function(){},
                                               {maximumAge:600000});
}

function disableTag(tag) {
    document.location.href = '/mirrors' + (document.location.search || '?q=') + ' ' + tag;
}
</script>

<%- query = req.parameters.q %>

<div class="search-bar" style="position: static">
  <strong>Sorting</strong>
  <ul>
    <img src="/static/icons/busy.gif" style="float: right; visibility: hidden" id="busy">
    <a href="javascript:searchForNearest()"><li>Nearest</li></a>
  </ul>
  <hr>
  <strong>Continents</strong>
  <%- continents = []; FOREACH mirror IN mirrors; continents.push(mirror.continent); END %>
  <ul>
  <% FOREACH continent IN continents.unique.sort %>
  <li><a href="/mirrors?continent=<% continent %>"><% continent %></a></li>
  <% END %>
  </ul>
  <hr>
  <strong>Countries</strong>
  <%- countries = []; FOREACH mirror IN mirrors; countries.push(mirror.country); END %>
  <ul>
  <% FOREACH country IN countries.unique.sort %>
  <li><a href="/mirrors?country=<% country %>"><% country %></a></li>
  <% END %>
  </ul>

</div>

<div class="search-results">


<% 
FOREACH mirror IN mirrors;
date = mirror.inceptdate.dt;
day = date.day _ '/' _ date.month _ '/' _ date.year %>

<div>
  <strong>
    <% mirror.name %> (<% mirror.org %>)</strong> 
    <% IF mirror.http %><a href="<% mirror.http %>">http</a><% END %>
    <% IF mirror.ftp %><a href="<% mirror.ftp %>">ftp</a><% END %>
    <% IF mirror.rsync %><a href="<% mirror.rsync %>">rsync</a><% END %>
    <% IF mirror.distance %>(<% mirror.distance | format_number %> km)<% END %>
</div>
<% END %>

</div>